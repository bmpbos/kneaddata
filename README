knead_data.py is a pipeline to perform quality control on metagenomic sequencing
data. It uses Trimmomatic to trim reads according to quality, and uses BMTagger
to remove sequences from the "host" genome. 

Requires: NCBI Blast

Input: 1 or 2 .fastq files (single-ended or paired-end)


Output: depends on whether or not the -x (or --extract) flag is used
If the output prefix (-o or --output-prefix) is not specified, the output prefix
defaults to the name of the first input .fastq file.

If -x (--extract) is used:
Will produce 1-4 outputs (depending on paired or single-end, and the quality of
the sequencing)

Paired end:
[output-prefix]_pe_1.fastq 
[output-prefix]_pe_2.fastq
[output-prefix]_se_1.fastq
[output-prefix]_se_2.fastq

Single end:
[output-prefix].fastq

outputs with *pe* are the paired-end reads, with reads from the "host" genome
removed. 

outputs with *se_[NUM]* are orphaned reads from the [NUM]th paired fastq input,
with sequences from the "host" genome removed. 

For single end reads, the output is another fastq with sequences from the "host"
genome removed. 

If -x (--extract) is NOT used:
The output will be [output-prefix].out, containing a list of fastq headers,
where each header indicates a read that was part of the "host" genome. 


Common uses:
If you have not already done so, you need to make BMTagger databasees. 

Run the following commands:
bmtool -d [reference].fasta -o [reference].bitmask -A 0 -z -w 18

srprism mkindex -i [reference].fasta -o [reference].srprism -M 7168

makeblastdb -in [reference].fasta -dbtype nucl -out [reference]

The references must all have the same prefix ([reference].*)


How to run the pipeline:

Single end:

python knead_data.py -1 [mate1].fastq [-o OUTPUT-PREFIX] -db [reference
databases] -t
[PATH TO TRIMMOMATIC] -b [PATH TO BMTAGGER] [--extract | -x] [-m MEMORY]

Memory must be a string, ie 8g or 500m

You can specify multiple reference databases.

Example usage (paired end):

python knead_data.py -1 spike.1.fastq -2 spike.2.fastq -o spike_out -db Homo_sapiens_assembly19.fasta -t Trimmomatic-0.32/trimmomatic-0.32.jar -b ~/bin/bmtagger.sh --extract -m 8g
